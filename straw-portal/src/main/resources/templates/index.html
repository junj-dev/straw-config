<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
	<head th:replace="commom/head :: head">
		
	</head>
	<head>
		<link th:href="@{/css/zpageNav.css}" rel="stylesheet" />
		<style>
			.question{
				max-height: 108px;
				line-height: 18px;
				display: -webkit-box;
				-webkit-line-clamp: 2;
				-webkit-box-orient: vertical/*! autoprefixer: on */;
				overflow: hidden;
				text-overflow: ellipsis;

			}

		</style>
	</head>

	<body class="hold-transition skin-blue sidebar-mini">
		<div class="wrapper" >
			<header th:replace="commom/head :: header"></header>
			<aside th:replace="commom/aside :: aside"></aside>
			<div class="content-wrapper" id="app">
					<section class="content-header">


					</section>
					<section class="content ">

						<div class="row" >
							<div class="row" >
								<div class="col-lg-8 col-lg-offset-1">

										<div class="input-group">
											<input type="text"  class="form-control"  v-on:keyup.13="pageHandler(1)" placeholder="输入问题的关键字" v-model="keyword" >
											<span class="input-group-btn">
											<button type="button" name="search" id="search-btn" class="btn btn-primary" v-on:click="pageHandler(1)" ><i class="fa fa-search"></i>
											</button>
										  </span>
										</div>

								</div>
								<div class="col-lg-3" >
									<button type="button" class="btn btn-primary" onclick="location.href='/question/create.html'">我要提问</button>
								</div>
							</div>
							<br>
							<br>
							<div class="row">
								<div class="col-lg-10 col-lg-offset-1">
									<ol class="breadcrumb">
										<li><a href="javascript:void(0)" :data-id="0" v-on:click="pageHandler3($event,1)"  >全部</a></li>
										<li v-for="tag in tags"><a href="javascript:void(0)" :data-id="tag.id" v-on:click="pageHandler3($event,1)"  >{{tag.name}}</a></li>

									</ol>
								</div>
							</div>
							<br><br>
							<div class="row">
								<div class="col-lg-10 col-lg-offset-1">
									<div class="panel panel-default" v-for="question in questions">
										<!-- Default panel contents -->
										<div class="panel-heading">
											<h4>
												<span class="label label-warning" v-if="question.status == '0'">未回答</span>
												<span class="label label-info" v-if="question.status == '1'">待解决</span>
												<span class="label label-success" v-if="question.status == '2'">已解决</span>
												<a :href="'/question/detail/'+question.id">{{question.title}}</a>
											</h4>
										</div>
										<div class="panel-body question"  v-html="question.content"></div>

										<div class="panel-footer">
											<span class="label label-default" style="margin-right: 2px"  v-for="tag in question.tags"><a href="javascript:void(0)" :data-id="tag.id" v-on:click="pageHandler3($event,1)"  >{{tag.name}}</a></span>

											<span  style="float:right;margin-right: 10px" >{{question.pageViews}}浏览</span>
											<span  style="float:right;margin-right: 10px" >{{question.distanceTime}}</span>
											<span  style="float:right;margin-right: 10px" >{{question.userNickName}}</span>
										</div>

									</div>
								</div>

							</div>
						</div>
						<div class="row">

							<!--显示分页信息-->
							<div class="modal-footer no-margin-top" v-if="show">

								<zpagenav v-bind:page="page" v-bind:page-size="pageSize" v-bind:total="total"
										  v-bind:max-page="maxPage"  v-on:pagehandler="pageHandler">
								</zpagenav>

							</div>
							<div class="modal-footer no-margin-top" v-else >

								<zpagenav v-bind:page="page" v-bind:page-size="pageSize" v-bind:total="total"
										  v-bind:max-page="maxPage"  v-on:pageHandler2="pageHandler2">
								</zpagenav>

							</div>
						</div>
					</section>
			</div>
			<footer th:replace="commom/footer :: footer"></footer>
		</div>
	</body>


	<script th:src="@{/js/zpageNav.js}"></script>
	<script th:src="@{/js/zpageNav2.js}"></script>
	<script>
		// $(document).ready(function(){
		// 	if(event.keyCode ===13){
		// 		vm.pageHandler(1);
		// 	}
		// });

		var vm = new Vue({
			el: '#app',
			data: {
				page: 0,  //显示的是哪一页
				pageSize: 5, //每一页显示的数据条数
				total: 0, //记录总数
				maxPage:9, //最大页数
				keyword:'',
				questions:[],
				tags:[],
				show:false,
				tagId:null



			},
			methods: {
				//pagehandler方法 跳转到page页
				pageHandler: function (pageNum) {
					//here you can do custom state update
					this.page = pageNum;
					var keyword=this.keyword;
					var pageSize=this.pageSize;
					this.show=true;
					var _this=this;

					$.ajax({
						type:"post",
						url:"/question/search",
						data:{
							"pageNum":pageNum,
							"pageSize":pageSize,
							"keyword":keyword
						},
						dataType: "json",
						success:function (res) {

							console.log(res);
							if(res.code==200){
								_this.total=res.data.total;
								_this.pages=res.data.totalPage;
								_this.questions=res.data.list;
							}
						}
					});
				},
				//加载标签
				loadTgs: function () {
					var _this=this;
					$.get("/tag/findAllTags",function(result){
						if(result.code==200){
							_this.tags=result.data;
							console.log("tags:"+result.data);
						}
					});
				},
				//根据标签加载问题
				pageHandler2:function (pageNum) {
					//here you can do custom state update

					this.page = pageNum;
					var pageSize=this.pageSize;
					var tagId=this.tagId;
					this.show=false;
					var _this=this;
					$.ajax({
						type:"post",
						url:"/question/findQuestionByTagId",
						data:{
							"pageNum":pageNum,
							"pageSize":pageSize,
							"tagId":tagId
						},
						dataType: "json",
						success:function (res) {

							console.log(res);
							if(res.code==200){
								_this.total=res.data.total;
								_this.pages=res.data.pages;
								_this.questions=res.data.list;
							}
						}
					});
				},
				pageHandler3:function (ev,pageNum) {
					//here you can do custom state update
					console.log(ev.target.dataset.id);

					this.page = pageNum;
					var pageSize=this.pageSize;
					var tagId=ev.target.dataset.id;
					this.tagId=tagId;
					this.show=false;
					var _this=this;
					$.ajax({
						type:"post",
						url:"/question/findQuestionByTagId",
						data:{
							"pageNum":pageNum,
							"pageSize":pageSize,
							"tagId":tagId
						},
						dataType: "json",
						success:function (res) {

							console.log(res);
							if(res.code==200){
								_this.total=res.data.total;
								_this.pages=res.data.pages;
								_this.questions=res.data.list;
							}
						}
					});
				}



			},
			created:function(){
				//created  表示页面加载完毕，立即执行
				this.tagId=0;
				this.pageHandler2();
				this.loadTgs();
			}
		});

	</script>

</html>